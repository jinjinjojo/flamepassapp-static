<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Game Details | Flamepass</title>
	<link rel="icon" type="icon/x-icon" href="/assets/favicon.ico" />

	<!-- Meta tags for SEO -->
	<meta name="description"
		content="Play games online with Flamepass, the next gen proxy. No downloads required, works directly in your browser." />
	<meta name="keywords" content="Games, Online Games, Free Games, Browser Games, Flamepass" />
	<meta property="og:image" content="/assets/logo.webp" />
	<meta property="og:title" content="Play Online Games | Flamepass" />
	<link rel="canonical" href="/game/" />

	<!-- Font imports -->
	<link rel="preload" as="style"
		href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />

	<!-- Icon libraries -->
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />

	<!-- Core stylesheets -->
	<link rel="stylesheet" href="/css/index.css" />
	<link rel="stylesheet" href="/css/themes.css" />
	<link rel="stylesheet" href="/css/common.css" />
	<link rel="stylesheet" href="/css/game-page.css" />
	<link rel="stylesheet" href="/css/enhanced-game-page.css" />

	<!-- Google Analytics -->
	<meta name="google-adsense-account" content="ca-pub-3747175608041884" />
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-SPVQHBL4J1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());
		gtag('config', 'G-SPVQHBL4J1');
	</script>
</head>

<body>
	<!-- Navigation Sidebar -->
	<nav class="navbar">
		<div class="navbar-top">
			<a href="/" class="logo-link">
				<img class="logo" src="/assets/logo.webp" alt="Flamepass Logo" />
			</a>
			<hr class="nav-divider" />
			<a href="/" title="Home" class="nav-item">
				<span class="material-symbols-outlined">cottage</span>
			</a>
			<a href="/&.html" title="Search" class="nav-item">
				<span class="material-symbols-outlined">public</span>
			</a>
		</div>

		<div class="navbar-middle">
			<hr class="nav-divider" />
			<a href="/a.html" title="Apps" class="nav-item">
				<span class="material-symbols-outlined">apps</span>
			</a>
			<a href="/g.html" title="Games" class="nav-item active">
				<span class="material-symbols-outlined">joystick</span>
			</a>
			<a href="/downloadable-games.html" title="Downloadable Games" class="nav-item">
				<span class="material-symbols-outlined">download</span>
			</a>
			<hr class="nav-divider" />
			<a href="/ultimate-links.html" title="Ultimate Link List" class="nav-item">
				<span class="material-symbols-outlined">list</span>
			</a>
			<a href="/links.html" title="Link Generator" class="nav-item">
				<span class="material-symbols-outlined">link</span>
			</a>
			<hr class="nav-divider" />
			<a href="/guides.html" title="Guides and Methods" class="nav-item">
				<span class="material-symbols-outlined">help_outline</span>
			</a>
			<a href="/yt-channels.html" title="Unblocker YouTube Channels" class="nav-item">
				<span class="material-symbols-outlined">play_circle</span>
			</a>
			<hr class="nav-divider" />
			<a href="/ai.html" title="AI Chat" class="nav-item">
				<span class="material-symbols-outlined">smart_toy</span>
			</a>
		</div>

		<div class="navbar-bottom">
			<hr class="nav-divider" />
			<a href="/~.html" title="Settings" class="nav-item">
				<span class="material-symbols-outlined">tune</span>
			</a>
			<a target="_blank" href="https://discord.com/invite/gVaXCTqJDq" title="Discord Server" class="nav-item">
				<i class="fab fa-discord"></i>
			</a>
		</div>
	</nav>

	<!-- Main Content -->
	<main class="main-content">
		<!-- Search button (top right corner) -->
		<button class="search-trigger" id="searchTrigger">
			<span class="material-symbols-outlined">search</span>
			<span class="search-text">Search games...</span>
			<span class="keyboard-shortcut">⌘K</span>
		</button>

		<!-- Game Container -->
		<div id="game-container" class="game-container">
			<!-- Loading animation (will be replaced by game content) -->
			<div class="loading-container">
				<div class="loader">
					<svg viewBox="0 0 80 80">
						<circle cx="40" cy="40" r="32" class="loader-circle" />
					</svg>
				</div>
				<p class="loading-text">Loading game information...</p>
			</div>
		</div>

		<!-- Footer -->
		<footer class="footer">
			<div class="footer-content">
				<div class="footer-logo">
					<img src="/assets/logo.webp" alt="Flamepass Logo" />
					<p>© 2023-2025 Flamepass</p>
				</div>
				<div class="footer-links">
					<a href="/terms.html">Terms of Service</a>
					<a href="/privacy.html">Privacy Policy</a>
					<a href="/about.html">About Us</a>
					<a href="https://discord.com/invite/gVaXCTqJDq" target="_blank">Discord</a>
				</div>
			</div>
		</footer>

		<!-- Scroll to top button -->
		<button class="scroll-top" id="scrollTopBtn">
			<span class="material-symbols-outlined">arrow_upward</span>
		</button>
	</main>

	<!-- Search Modal -->
	<div class="search-modal" id="searchModal">
		<div class="search-modal-content">
			<div class="search-header">
				<div class="search-input-container">
					<span class="material-symbols-outlined">search</span>
					<input type="text" id="searchInput" placeholder="Search for games..." autofocus />
					<button class="close-search" id="closeSearch">
						<span class="material-symbols-outlined">close</span>
					</button>
				</div>
				<div class="search-shortcuts">
					<span class="shortcut-item"><kbd>↑</kbd><kbd>↓</kbd> to navigate</span>
					<span class="shortcut-item"><kbd>↵</kbd> to select</span>
					<span class="shortcut-item"><kbd>Esc</kbd> to close</span>
				</div>
			</div>
			<div class="search-results" id="searchResults">
				<!-- Will be populated by JS -->
			</div>
		</div>
	</div>

	<!-- Background elements -->
	<div class="background-elements">
		<div class="blob"></div>
		<div class="blobbig"></div>
		<div class="blobsmall"></div>
		<div class="blobtop"></div>
		<div id="particles-js"></div>
	</div>

	<!-- Scripts -->
	<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
	<script src="/js/localforage.min.js"></script>
	<script src="/js/game-loader.js"></script>
	<script src="/js/game-page.js"></script>
	<script src="/js/themes.js"></script>
	<script src="/js/c.js"></script>
	<script src="/js/auth-controller.min.js"></script>
	<script>
		// Initialize particles.js
		particlesJS('particles-js', {
			particles: {
				number: { value: 80, density: { enable: true, value_area: 800 } },
				color: { value: '#ffffff' },
				shape: { type: 'circle' },
				opacity: { value: 0.5, random: true },
				size: { value: 3, random: true },
				line_linked: { enable: false },
				move: {
					enable: true,
					speed: 0.3,
					direction: 'top',
					random: true,
					straight: false,
					out_mode: 'out'
				}
			}
		});

		// IndexedDB Configuration
		const DB_NAME = 'flamepass_games';
		const DB_VERSION = 1;
		const GAME_STORE = 'games';
		const META_STORE = 'meta';
		const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours in milliseconds

		// Initialize IndexedDB
		function initDB() {
			return new Promise((resolve, reject) => {
				if (!window.indexedDB) {
					console.warn('IndexedDB not supported, falling back to localStorage');
					resolve(null);
					return;
				}

				const request = indexedDB.open(DB_NAME, DB_VERSION);

				request.onerror = event => {
					console.error('IndexedDB error:', event.target.error);
					resolve(null); // Resolve with null to indicate fallback needed
				};

				request.onupgradeneeded = event => {
					const db = event.target.result;

					// Create object stores if they don't exist
					if (!db.objectStoreNames.contains(GAME_STORE)) {
						db.createObjectStore(GAME_STORE, { keyPath: 'slug' });
					}

					if (!db.objectStoreNames.contains(META_STORE)) {
						db.createObjectStore(META_STORE, { keyPath: 'key' });
					}
				};

				request.onsuccess = event => {
					resolve(event.target.result);
				};
			});
		}

		// Get all data from a store
		async function getAllFromDB(db, storeName) {
			return new Promise((resolve, reject) => {
				if (!db) {
					resolve(null);
					return;
				}

				const transaction = db.transaction(storeName, 'readonly');
				const store = transaction.objectStore(storeName);
				const request = store.getAll();

				request.onsuccess = event => {
					resolve(event.target.result);
				};

				request.onerror = event => {
					console.error(`Error getting data from ${storeName}:`, event.target.error);
					resolve(null);
				};
			});
		}

		// Get a specific item from a store
		async function getFromDB(db, storeName, key) {
			return new Promise((resolve, reject) => {
				if (!db) {
					resolve(null);
					return;
				}

				const transaction = db.transaction(storeName, 'readonly');
				const store = transaction.objectStore(storeName);
				const request = store.get(key);

				request.onsuccess = event => {
					resolve(event.target.result);
				};

				request.onerror = event => {
					console.error(`Error getting item from ${storeName}:`, event.target.error);
					resolve(null);
				};
			});
		}

		// Get games from cache, IndexedDB, or fetch from server
		async function getGamesData() {
			// Try to get from memory cache
			if (window.cache && window.cache.games && Array.isArray(window.cache.games)) {
				return window.cache.games;
			}

			// Initialize IndexedDB
			const db = await initDB();

			// Check IndexedDB
			if (db) {
				const meta = await getFromDB(db, META_STORE, 'lastUpdated');
				const currentTime = Date.now();

				// If we have fresh data in IndexedDB
				if (meta && (currentTime - meta.timestamp < CACHE_DURATION)) {
					console.log('Loading games from IndexedDB cache');
					const games = await getAllFromDB(db, GAME_STORE);

					if (games && games.length > 0) {
						// Update memory cache if available
						if (window.cache) {
							window.cache.games = games;
						}
						return games;
					}
				}
			}

			// Try to get from localStorage as fallback
			try {
				const cachedData = localStorage.getItem('cache_games');
				if (cachedData) {
					const parsed = JSON.parse(cachedData);
					if (parsed.data && Array.isArray(parsed.data)) {
						return parsed.data;
					}
				}
			} catch (e) {
				console.warn('Error loading games from localStorage:', e);
			}

			// If nothing is cached, fetch from server
			try {
				console.log('Fetching fresh game data from server');
				const response = await fetch('/json/g.json');
				const games = await response.json();

				// Update memory cache if available
				if (window.cache) {
					window.cache.games = games;
				}

				return games;
			} catch (error) {
				console.error('Error fetching games data:', error);
				return [];
			}
		}

		// Search modal functionality
		document.addEventListener('DOMContentLoaded', () => {
			const searchTrigger = document.getElementById('searchTrigger');
			const searchModal = document.getElementById('searchModal');
			const closeSearch = document.getElementById('closeSearch');
			const searchInput = document.getElementById('searchInput');
			const searchResults = document.getElementById('searchResults');

			// Open search modal
			searchTrigger.addEventListener('click', () => {
				searchModal.classList.add('active');
				setTimeout(() => {
					searchInput.focus();
				}, 100);
			});

			// Close search modal
			closeSearch.addEventListener('click', () => {
				searchModal.classList.remove('active');
			});

			// Close on escape key
			document.addEventListener('keydown', (e) => {
				if (e.key === 'Escape' && searchModal.classList.contains('active')) {
					searchModal.classList.remove('active');
				}

				// Open on Cmd+K or Ctrl+K
				if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
					e.preventDefault();
					searchModal.classList.add('active');
					setTimeout(() => {
						searchInput.focus();
					}, 100);
				}
			});

			// Click outside to close
			searchModal.addEventListener('click', (e) => {
				if (e.target === searchModal) {
					searchModal.classList.remove('active');
				}
			});

			// Search input handler with debounce
			let debounceTimer;
			searchInput.addEventListener('input', () => {
				clearTimeout(debounceTimer);

				const query = searchInput.value.trim();

				if (query.length < 2) {
					searchResults.innerHTML = `
						<div class="search-message">
							<span class="material-symbols-outlined">search</span>
							<p>Type at least 2 characters to search</p>
						</div>
					`;
					return;
				}

				// Set loading state
				searchResults.innerHTML = `
					<div class="search-message">
						<div class="loader" style="width: 30px; height: 30px;">
							<svg viewBox="0 0 80 80">
								<circle cx="40" cy="40" r="32" class="loader-circle" />
							</svg>
						</div>
						<p>Searching...</p>
					</div>
				`;

				// Debounce search request
				debounceTimer = setTimeout(async () => {
					try {
						// Get games using IndexedDB
						const allGames = await getGamesData();

						// Filter games based on query
						const lowerCaseQuery = query.toLowerCase();
						const filteredGames = allGames.filter(game =>
							(game.name && game.name.toLowerCase().includes(lowerCaseQuery)) ||
							(game.description && game.description.toLowerCase().includes(lowerCaseQuery)) ||
							(game.category && game.category.toLowerCase().includes(lowerCaseQuery)) ||
							(game.tags && Array.isArray(game.tags) && game.tags.some(tag => tag.toLowerCase().includes(lowerCaseQuery)))
						);

						// Display results
						if (filteredGames.length === 0) {
							searchResults.innerHTML = `
								<div class="search-message">
									<span class="material-symbols-outlined">sentiment_dissatisfied</span>
									<p>No games found matching "${query}"</p>
								</div>
							`;
						} else {
							searchResults.innerHTML = '';

							filteredGames.slice(0, 8).forEach(game => {
								const resultItem = document.createElement('a');
								resultItem.href = `/game/${game.slug}`;
								resultItem.className = 'search-result-item';

								resultItem.innerHTML = `
									<div class="search-result-image">
										<img src="${game.img}" alt="${game.name}" loading="lazy">
									</div>
									<div class="search-result-info">
										<h3>${game.name}</h3>
										<div class="search-result-meta">
											<span class="category-pill">${game.category ? game.category.charAt(0).toUpperCase() + game.category.slice(1) : 'Browser Game'}</span>
											${game.publisher ? `<span class="publisher">${game.publisher}</span>` : ''}
										</div>
									</div>
								`;

								searchResults.appendChild(resultItem);
							});

							if (filteredGames.length > 8) {
								const viewAll = document.createElement('a');
								viewAll.href = `/g.html?search=${encodeURIComponent(query)}`;
								viewAll.className = 'view-all-results';
								viewAll.innerHTML = `View all ${filteredGames.length} results <span class="material-symbols-outlined">arrow_forward</span>`;
								searchResults.appendChild(viewAll);
							}
						}
					} catch (error) {
						console.error('Error during search:', error);
						searchResults.innerHTML = `
							<div class="search-message">
								<span class="material-symbols-outlined">error</span>
								<p>An error occurred while searching</p>
							</div>
						`;
					}
				}, 300);
			});

			// Init scroll to top button
			const scrollTopBtn = document.getElementById('scrollTopBtn');
			window.addEventListener('scroll', () => {
				if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
					scrollTopBtn.classList.add('visible');
				} else {
					scrollTopBtn.classList.remove('visible');
				}
			});

			scrollTopBtn.addEventListener('click', () => {
				window.scrollTo({
					top: 0,
					behavior: 'smooth'
				});
			});

			// Check if current page is a game detail page
			const path = window.location.pathname;
			if (path.startsWith('/game/')) {
				// Extract game slug from URL
				const slug = path.split('/').pop();

				// Check if slug exists and load game details
				if (slug && typeof window.loadGameDetails === 'function') {
					window.loadGameDetails(slug);
				} else {
					// Fallback error handling
					setTimeout(() => {
						const container = document.getElementById('game-container');
						if (container && container.querySelector('.loading-container')) {
							console.warn('Game loading timeout detected, attempting to recover');

							// Try to load game details through IndexedDB
							getGamesData().then(games => {
								const game = games.find(g => g.slug === slug);

								if (game && typeof window.renderGameDetails === 'function') {
									window.renderGameDetails(container, game, games);
								} else {
									container.innerHTML = `
										<div class="error-message">
											<span class="material-symbols-outlined">error</span>
											<h3>Game Not Found</h3>
											<p>Sorry, we couldn't find the game you're looking for.</p>
											<a href="/g.html" class="retry-button">Browse All Games</a>
										</div>
									`;
								}
							}).catch(error => {
								console.error('Error loading game details:', error);
							});
						}
					}, 3000);
				}
			}
		});

		// Handle ads based on user preferences
		document.addEventListener('DOMContentLoaded', function () {
			let hideAds = localStorage.getItem('hideAds');

			if (hideAds === null || hideAds === 'false') {
				let script = document.createElement('script');
				script.type = 'text/javascript';
				script.src =
					'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3747175608041884';
				document.body.appendChild(script);
			}
		});
	</script>
</body>

</html>